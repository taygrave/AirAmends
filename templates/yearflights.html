{% extends 'base.html' %}
{% block body %}

<h2>{{year}}</h2>
We found a total of {{results_list|length}} flights for you! <a href="#">Edit</a>*<br>
<a href="javascript:history.back()">Go Back</a>
<br><br>
<script>
var deleteFlight = function(id, tRow){
    var formData = new FormData();
    formData.append("id", id)

    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open("POST", "/delete_flight", true);
    console.log(tRow);

    xmlhttp.onreadystatechange = function(){
        console.log(xmlhttp.onreadystate)
        if (xmlhttp.readyState == 4){
            if (xmlhttp.responseText == "OK"){
                var row = document.getElementById(tRow);
                row.remove();
            } else {
                // TODO update this to be more useful
                console.log("Flight cannot be removed");
            };
        };
    };
    xmlhttp.send(formData);
}
</script>

<!-- TODO: need to give unique id to table row - name it after the id (row-id#)
get element by id and remove from table
JS methods Document.getElementById and remove())-->

<table class="table table-striped">
    
    <tr class="info">
        <th>Purchased On:</th><th>Departing From:</th><th>Arriving In:</th><th>CO2e Emissions</th><th>Emissions Value (2015$)</th><th></th>
    </tr>
        
    {% for flight in results_list %}
    <tr id={{"row-%d" % flight[4]}}>
        <td>{{flight[0]}}</td>
        <td>{{flight[1]}}</td>
        <td>{{flight[2]}}</td>
        <td>{{'%0.2f' % flight[3]}}</td>
        <td>${{'%0.2f' % (flight[3]*37)}}</td>
        <td><button type="button" class="btn btn-danger" style="visibility: hidden" id="{{flight[4]}}" onclick="deleteFlight('{{flight[4]}}', '{{'row-%d' % flight[4]}}')">DELETE</button></td>
    </tr>
    {% endfor %}
        
    <tr class="info">
        <th>TOTALS</th><th> </th><th> </th><th>{{'%0.2f' % sum_CO2e}}</th><th>${{'%0.2f' % (sum_CO2e*37)}}</th><th></th></tr>
    </tr>

</table>

<script>
$('table').on('mouseover', 'tr', function(ev) {
    $(this).find('button').css({'visibility': 'visible'});
}).on('mouseout', 'tr', function(ev) {
    $(this).find('button').css({'visibility': 'hidden'});
});
</script>

*TODO: Click here to be able to delete a flight from the table or add one
{% endblock %}